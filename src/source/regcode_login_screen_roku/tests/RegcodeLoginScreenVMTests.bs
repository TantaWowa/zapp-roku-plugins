'@TestSuite [RCLSVMT] RegcodeLoginScreenVM Tests
namespace RCLSVMT

'@BeforeEach
function beforeEach()
  localStore = createObject("roSGNode", "ZSessionStore")
  modelLocator = createObject("roSGNode", "ModelLocator")
  modelLocator.addfields({ "ZPLocalStore": localStore })
  TU.setModelLocator(modelLocator)
  
  riversJson = {
    "id": "regcodeScreen"
    styles: {
    }
  }
  
  m.vm = new RegcodeLoginScreenVM(riversJson)
  m.analyticsManager = { "id" : "analyticsManager" }
  m.vm.analyticsManager = m.analyticsManager
  
  m.vm.initialize()
end function

'@AfterEach
function afterEach()
  m.global.delete("zapp")
  TU.unsetModelLocator()
end function

'+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
'@It tests refreshLogin
'+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

'@Test
'@Params[invalid]
'@Params["id1"]
'@Params["id2"]
function refreshLogin(providerId)
  authTask = { "id" : "authTask" }
  
  m.expectOnce(m.vm, "createAuthTask", ["execLoad", providerId, "onRefreshLoginComplete"], authTask)
  m.vm.providerId = providerId
  
  m.vm.refreshLogin()
  
  m.assertEqual(m.vm.authTask, authTask)
  
  m.assertFalse(m.vm.isContentGroupVisible)
end function

'+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
'@It tests onRefreshLoginComplete
'+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

'@Test success
function onRefreshLoginComplete_success()
  user = { "id" : "user", isLoggedIn: true }
  m.expectOnce(m.vm, "getInstance", ["user"], user)
  
  m.vm.onRefreshLoginComplete({})

  m.assertFalse(m.vm.isShowingLoadingIndicator)
  m.assertEqual(m.vm.state, "success")
  
end function

'@Test not valid
function onRefreshLoginComplete_not_valid()
  user = { "id" : "user", isLoggedIn: false }
  m.expectOnce(m.vm, "getInstance", ["user"], user)
  
  m.vm.onRefreshLoginComplete({})

  m.assertFalse(m.vm.isShowingLoadingIndicator)
  m.assertNotEqual(m.vm.state, "success")
  m.assertTrue(m.vm.isContentGroupVisible)
  
end function


'+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
'@It tests onKeyPressBack
'+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

'@Test 
function onKeyPressBack()
  m.expectOnce(m.vm, "dismiss", ["cancel"])
  m.vm.onKeyPressBack()
  
end function

'TODO !!!
end namespace